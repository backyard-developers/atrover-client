# Quad Motor Control Protocol

L293D 모터 쉴드를 사용한 4개 DC 모터 제어 프로토콜 (M1~M4)

## Ready 신호

Arduino 부팅 및 모터 초기화 완료 후 시리얼로 Ready 신호를 전송합니다:
```
<O00>
```
Android는 이 메시지를 수신하면 명령 전송을 시작할 수 있습니다.

## 단일 모터 프로토콜

### 요청 (Android -> Arduino)
```
[STX][모터ID][명령][속도][체크섬][ETX]
```

| 필드 | 바이트 | 값 | 설명 |
|------|--------|-----|------|
| STX | 1 | `<` (0x3C) | 시작 문자 |
| 모터ID | 1 | `1`~`4` | 모터 번호 (M1~M4) |
| 명령 | 1 | `0`, `1`, `2` | 정지/정회전/역회전 |
| 속도 | 1 | 0x00~0xFF | 모터 속도 (0-255) |
| 체크섬 | 1 | XOR | 모터ID XOR 명령 XOR 속도 |
| ETX | 1 | `>` (0x3E) | 종료 문자 |

### 명령 코드
| 코드 | 동작 |
|------|------|
| `0` | 정지 (RELEASE) |
| `1` | 정회전 (FORWARD) |
| `2` | 역회전 (BACKWARD) |

### 체크섬 계산
```
체크섬 = 모터ID XOR 명령 XOR 속도
```

예시:
- 모터1 정회전 속도255: `<11\xFF\xCF>` (체크섬: '1' XOR '1' XOR 0xFF)
- 모터2 역회전 속도128: `<22\x80\xB0>` (체크섬: '2' XOR '2' XOR 0x80)

### 응답 (Arduino -> Android)
```
[STX][상태][모터ID][명령][ETX]
```

| 상태 | 의미 |
|------|------|
| `O` | OK - 명령 성공 |
| `E` | Error - 체크섬 오류 |
| `X` | Error - 잘못된 명령 |
| `M` | Error - 잘못된 모터ID |

예시:
- 성공: `<O11>` - 모터1 정회전 성공
- 체크섬 오류: `<E00>`
- 잘못된 명령: `<X13>` - 명령 3은 없음
- 잘못된 모터: `<M51>` - 모터5는 없음

## 멀티 모터 프로토콜

여러 모터를 하나의 명령으로 동시 제어합니다. 모든 모터는 동일한 속도를 공유합니다.

### 요청 (Android -> Arduino)
```
[STX]M[모터수][cmd1]...[cmdN][속도][체크섬][ETX]
```

| 필드 | 바이트 | 값 | 설명 |
|------|--------|-----|------|
| STX | 1 | `<` (0x3C) | 시작 문자 |
| M | 1 | `M` | 멀티 모터 명령 표시 |
| 모터수 | 1 | `2`, `4` | 제어할 모터 수 |
| cmd1~N | N | `0`, `1`, `2` | 각 모터별 명령 |
| 속도 | 1 | 0x00~0xFF | 공유 속도 (0-255) |
| 체크섬 | 1 | XOR | 아래 참고 |
| ETX | 1 | `>` (0x3E) | 종료 문자 |

### 모터 매핑
| 모터수 | 매핑 | 용도 |
|--------|------|------|
| `2` | cmd1→M3(좌), cmd2→M4(우) | 2WD 좌우 바퀴 |
| `4` | cmd1→M1, cmd2→M2, cmd3→M3, cmd4→M4 | 4WD 전체 모터 |

### 체크섬 계산
```
체크섬 = 'M' XOR 모터수 XOR cmd1 XOR ... XOR cmdN XOR 속도
```

예시 (2모터, 둘 다 정회전, 속도 200):
```
<M211\xC8[checksum]>
```
- 체크섬: 'M' XOR '2' XOR '1' XOR '1' XOR 0xC8

### 응답 (Arduino -> Android)
```
[STX][상태][모터수]M[ETX]
```

| 상태 | 의미 |
|------|------|
| `O` | OK - 전체 모터 명령 성공 |
| `E` | Error - 체크섬/검증 오류 |

예시:
- 성공: `<O2M>` - 2모터 명령 성공
- 실패: `<E4M>` - 4모터 명령 오류

## 타임아웃
- 요청 후 100ms 내 응답 없으면 재전송
- 3회 실패 시 연결 끊김 처리

## 하드웨어 연결
- M1 포트: 모터 1
- M2 포트: 모터 2
- M3 포트: 모터 3 (2WD 좌측 바퀴)
- M4 포트: 모터 4 (2WD 우측 바퀴)
- 외부 전원 필요 (모터용)

## 라이브러리
- Arduino: AFMotor (Adafruit Motor Shield Library)
